---
// src/views/ZibasCreators/index.astro
import LazyImage from '../../components/common/LazyImage.astro';
import { t } from '../../i18n/i18n';
import type { Locale } from '../../i18n/i18n';
import { getLocale } from '../../i18n/i18n';
import MainLayout from '../../layouts/MainLayout.astro';
import { logos } from '../../config/assets';
import PixelGrid from '../../components/atoms/PixelGrid.astro';
import CategoriesCarousel from '../../components/categories/CategoriesCarousel.astro';
import { getParticipations } from '../../services/participationService';
import PostCard from '../../components/creators/PostCard.astro';
import Lightbox from '../../components/creators/Lightbox.astro';
import './styles.css';
import { PUBLIC_PROMOTION_ID } from '../../config/env';
import juradosData from '../../locales/es/jurados.json';

// Import categories data
import categoriesEs from '../../locales/es/categories-zibas-creators.json';
import categoriesEn from '../../locales/en/categories-zibas-creators.json';

interface Props {
  currentLang: Locale;
  headerColorConfig?: any;
}

const { currentLang, headerColorConfig } = Astro.props;

// Get current locale if not provided
const locale = currentLang || getLocale();

// Get categories data based on locale
const categoriesData = locale === 'es' ? categoriesEs : categoriesEn;

// Jurados data and helpers (to embed Jurados section)
const { title: jurTitle, description: jurDescription, countries, jurors } = juradosData as any;
const allJurors = countries.flatMap((country: any) =>
  (jurors[country.id] || []).map((juror: any) => ({
    ...juror,
    countryId: country.id,
    countryName: country.name,
  }))
);
const socialMedia = t('social_media', { namespace: 'common', locale: currentLang as Locale }) as any;

// Meta information
const title = 'Ziba\'s Creators - Concurso de Creatividad';
const metaDescription = 'Participa en el concurso de creatividad de Ziba\'s. Sube tu contenido en video, baile, música, arte, memes e inteligencia artificial y gana premios increíbles.';

// Llamada al nuevo servicio para obtener las participaciones
interface ParticipationItem {
  id: number;
  description: string;
  image?: string;
  thumbnail?: string;
  link?: string;
  country?: string;
  categories?: string[];
  contact?: {
    firstName?: string;
    lastName?: string;
  };
  // Agrega aquí cualquier otra propiedad que necesites
}

let participations: ParticipationItem[] = [];
let pagination = { page: 1, pageSize: 10, pageCount: 1, total: 0 };
const promotionId = PUBLIC_PROMOTION_ID || 0; // ID de la promoción desde env
const initialPage = 1;
const initialPageSize = 10;
try {
  const participationData = await getParticipations(promotionId, initialPage, initialPageSize);
  participations = participationData.data;
  pagination = participationData.meta?.pagination || pagination;
  console.log('[ZibasCreatorsView] Participations loaded:', participations);
} catch (error) {
  console.error('[ZibasCreatorsView] Failed to load participations:', error);
}

---

<MainLayout title={title} description={metaDescription} headerColors={headerColorConfig}>
  <Lightbox />
      <!-- Hero Section - Orange -->
    <section id="hero" class="min-h-[420px] lg:h-[800px] relative overflow-hidden py-12 lg:py-0" style="background-image: url('https://snack.yummiespromociones.com/SnacksyummiesAssets/coverzibascreators.webp'); background-size: cover; background-position: center; background-repeat: no-repeat;">
      <!-- Background decorative bars -->
      
      
      <!-- Main content -->
      <div class="relative z-10 flex items-center justify-center h-full">
        <div class="container mx-auto px-4 h-full">
          <div class="flex items-center justify-center h-full">
            <!-- Left Content -->
       
            
            <!-- Right Content - Ziba's Creators Image -->
            <div class="relative hero-graphic flex justify-center animate-fade-in-left">
              <div class="relative z-10 max-w-md lg:max-w-lg text-center flex flex-col items-center ">
                <!-- Main Ziba's Creators Image -->
                <div class="relative">
                  <LazyImage
                    src="https://snack.yummiespromociones.com/SnacksyummiesAssets/logozibascreators.webp" 
                    alt="Ziba's Creators" 
                    class="w-full h-auto object-contain animate-fade-in-up animation-delay-300"
                  />
                    <a href="https://zibascreators.yummiespromociones.com/" target="_blank" class="inline-block bg-orange border border-white text-white font-bold py-4 px-8 rounded-md text-lg mt-6 md:mt-8">
              Participa
             </a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Navigation indicators -->
   
    </section>

    <!-- How to Participate Section - Blue -->
    <section id="how-to-participate" class="bg-blue py-20 relative">
      
      <div class="container mx-auto px-4">
        <!-- Title Section -->
        <div class="text-center mb-16 animate-fade-in-up">
          <h2 class="text-white  italic text-4xl md:text-5xl font-title font-bold mb-4 leading-tight animate-fade-in-up animation-delay-200">
            DESCUBRE COMO PUEDES
          </h2>
          <h3 class="text-white italic text-6xl md:text-8xl font-title font-bold leading-tight animate-fade-in-up animation-delay-400">
            PARTICIPAR
          </h3>
        </div>
        
        <!-- Cards Grid -->
        <div class="relative max-w-7xl mx-auto">
          <!-- Top Row -->
          <div class="flex flex-col md:flex-row gap-8 mb-8">
            <!-- Step 1 -->
            <div class="bg-blue-700 rounded-[30px] p-10 flex flex-col gap-5 step-card animate-fade-in-up animation-delay-600">
              <h4 class="text-white text-2xl md:text-3xl font-title font-bold text-center leading-tight">
                REGÍSTRATE Y CREA TU CUENTA
              </h4>
              <div class="flex items-center gap-2 opacity-80">
                <div class="flex-1 h-0.5 bg-white"></div>
                <span class="text-white text-lg md:text-xl font-title font-bold uppercase whitespace-nowrap">
                  PASO Nº1
                </span>
                <div class="flex-1 h-0.5 bg-white"></div>
              </div>
            </div>
            
            <!-- Step 2 -->
            <div class="bg-blue-700 rounded-[30px] p-10 flex flex-col gap-5 step-card animate-fade-in-up animation-delay-800">
              <h4 class="text-white text-2xl md:text-3xl font-title font-bold text-center leading-tight">
                ELIGE CATEGORÍAS Y SUBE TU MEJOR CONTENIDO
              </h4>
              <div class="flex items-center gap-2 opacity-80">
                <div class="flex-1 h-0.5 bg-white"></div>
                <span class="text-white text-lg md:text-xl font-title font-bold uppercase whitespace-nowrap">
                  PASO Nº2
                </span>
                <div class="flex-1 h-0.5 bg-white"></div>
              </div>
            </div>
            
            <!-- Step 3 -->
            <div class="bg-blue-700 rounded-[30px] p-10 flex flex-col gap-5 step-card animate-fade-in-up animation-delay-1000">
              <h4 class="text-white text-2xl md:text-3xl font-title font-bold text-center leading-tight">
                ESPERA A QUE PUEDAS SER JUZGADO
              </h4>
              <div class="flex items-center gap-2 opacity-80">
                <div class="flex-1 h-0.5 bg-white"></div>
                <span class="text-white text-lg md:text-xl font-title font-bold uppercase whitespace-nowrap">
                  PASO Nº3
                </span>
                <div class="flex-1 h-0.5 bg-white">
                  
                </div>
              </div>
            </div>
          </div>
          
          <!-- Bottom Row - Single Card -->
          <div class="flex justify-center">
            <div class="bg-blue-700 rounded-[30px] p-10 flex flex-col gap-5 step-card max-w-md animate-fade-in-up animation-delay-1200">
              <h4 class="text-white text-2xl md:text-3xl font-title font-bold text-center leading-tight">
                ¡GANA INCREÍBLES PREMIOS COMO $5,000 EN EFECTIVO, UNA MACBOOK AIR M2, CÁMARAS, LUCES PROFESIONALES Y MUCHO MÁS!
              </h4>
              <div class="flex items-center gap-2 opacity-80">
                <div class="flex-1 h-0.5 bg-white"></div>
                <span class="text-white text-lg md:text-xl font-title font-bold uppercase whitespace-nowrap">
                  PREMIO
                </span>
                <div class="flex-1 h-0.5 bg-white"></div>
              </div>
            </div>
          </div>
          
      
          
          <!-- Circular Face Image -->
          <div id="emoji" class="absolute bottom-8 left-8 hidden lg:block">
            <div class="bg-pink rounded-full w-36 h-36 flex items-center justify-center">
              <div class="w-28 h-28 bg-pink rounded-full flex items-center justify-center">
                <LazyImage
                  src="https://snack.yummiespromociones.com/SnacksyummiesAssets/emojizibas.webp"
                  alt="Ziba's Creators" 
                  class="w-full h-full object-contain"
                />
              </div>
            </div>
          </div>

          <div  class="absolute bottom-8 right-8 hidden lg:block">
            <div class="w-36 h-36 flex items-center justify-center">
              <div class="w-28 h-28flex items-center justify-center">
                <PixelGrid
                pixelSize={20}
                density={0.7}
                background='bg-blue'
                introDuration={800}
                loopInterval={1100}
                mutateAmount={50}
              />
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Upload Content Section - Yellow -->
    <section id="upload" class="bg-yellow py-20">
      <div class="container mx-auto px-4">
        <!-- Title Section -->
        <div class="text-center mb-16 animate-fade-in-up">
          <h2 class="text-brown italic text-4xl md:text-5xl font-title font-bold mb-4 leading-tight animate-fade-in-up animation-delay-200">
            AQUÍ PUEDES SUBIR TU
          </h2>
          <div class="absolute left-0 top-0 w-[100%] h-[100%] -z-10 pointer-events-none -ml-[250px]">
            <PixelGrid
               pixelSize={20}
               density={0.7}
               introDuration={800}
               loopInterval={1100}
               mutateAmount={50}
             />
          </div>
          <h3 class="text-brown italic text-6xl md:text-8xl font-title font-bold leading-tight animate-fade-in-up animation-delay-400">
            CONTENIDO
          </h3>
        </div>
        
        <!-- Checklist Items -->
        <div class="relative max-w-6xl mx-auto mb-16">
          <!-- Item 1 -->
          <div class="bg-[#f0dc1c] rounded-[162px] px-8 py-7 flex items-center gap-4 mb-4 checklist-item animate-fade-in-up animation-delay-600">
            <div class="w-10 h-10 flex items-center justify-center">
              <svg xmlns="http://www.w3.org/2000/svg" width="44" height="43" viewBox="0 0 44 43" fill="none">
<path d="M34.5561 33.7599H34.5729M34.5561 33.7599C33.4505 34.8563 31.4469 34.5832 30.0419 34.5832C28.3172 34.5832 27.4867 34.9205 26.2558 36.1514C25.2077 37.1997 23.8026 39.0862 22.1449 39.0862C20.4872 39.0862 19.0821 37.1997 18.034 36.1514C16.8032 34.9205 15.9726 34.5832 14.2479 34.5832C12.8429 34.5832 10.8393 34.8563 9.73376 33.7599C8.61936 32.6549 8.89361 30.643 8.89361 29.2289C8.89361 27.4419 8.5028 26.6202 7.23021 25.3476C5.33718 23.4546 4.39066 22.508 4.39062 21.3319C4.39064 20.1557 5.33714 19.2092 7.23016 17.3162C8.36617 16.1802 8.89361 15.0545 8.89361 13.4349C8.89361 12.0298 8.62057 10.0262 9.71691 8.92069C10.822 7.80632 12.8339 8.08059 14.248 8.08059C15.8675 8.08059 16.9932 7.55318 18.1292 6.41721C20.0222 4.52415 20.9687 3.57764 22.1449 3.57764C23.3211 3.57764 24.2676 4.52415 26.1606 6.41721C27.2963 7.55295 28.422 8.08059 30.0419 8.08059C31.4469 8.08059 33.4507 7.80754 34.5562 8.90393C35.6705 10.009 35.3962 12.0209 35.3962 13.4349C35.3962 15.2219 35.7871 16.0436 37.0596 17.3162C38.9527 19.2092 39.8992 20.1557 39.8992 21.3319C39.8992 22.508 38.9527 23.4546 37.0596 25.3476C35.787 26.6202 35.3962 27.4419 35.3962 29.2289C35.3962 30.643 35.6705 32.6549 34.5561 33.7599Z" stroke="#141B34" stroke-width="2.75935"/>
<path d="M16.8184 22.9169L20.0141 25.7702L27.4709 16.8931" stroke="#141B34" stroke-width="2.75935" stroke-linecap="round" stroke-linejoin="round"/>
</svg>
            </div>
            <p class="text-[#5b3f2e] text-xl md:text-2xl font-medium flex-1">
              Sé original, muéstranos algo único
            </p>
            <div class="w-9 h-9 flex items-center justify-center">
              <svg class="w-9 h-9 text-[#5b3f2e]" fill="currentColor" viewBox="0 0 24 24">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/>
              </svg>
            </div>
          </div>
        
          <!-- Item 2 -->
          <div class="bg-[#f0dc1c] rounded-[162px] px-8 py-7 flex items-center gap-4 mb-4 checklist-item ml-16 md:ml-32 animate-fade-in-up animation-delay-800">
            <div class="w-10 h-10 flex items-center justify-center">
             <svg xmlns="http://www.w3.org/2000/svg" width="44" height="43" viewBox="0 0 44 43" fill="none">
<path d="M34.5561 33.7599H34.5729M34.5561 33.7599C33.4505 34.8563 31.4469 34.5832 30.0419 34.5832C28.3172 34.5832 27.4867 34.9205 26.2558 36.1514C25.2077 37.1997 23.8026 39.0862 22.1449 39.0862C20.4872 39.0862 19.0821 37.1997 18.034 36.1514C16.8032 34.9205 15.9726 34.5832 14.2479 34.5832C12.8429 34.5832 10.8393 34.8563 9.73376 33.7599C8.61936 32.6549 8.89361 30.643 8.89361 29.2289C8.89361 27.4419 8.5028 26.6202 7.23021 25.3476C5.33718 23.4546 4.39066 22.508 4.39062 21.3319C4.39064 20.1557 5.33714 19.2092 7.23016 17.3162C8.36617 16.1802 8.89361 15.0545 8.89361 13.4349C8.89361 12.0298 8.62057 10.0262 9.71691 8.92069C10.822 7.80632 12.8339 8.08059 14.248 8.08059C15.8675 8.08059 16.9932 7.55318 18.1292 6.41721C20.0222 4.52415 20.9687 3.57764 22.1449 3.57764C23.3211 3.57764 24.2676 4.52415 26.1606 6.41721C27.2963 7.55295 28.422 8.08059 30.0419 8.08059C31.4469 8.08059 33.4507 7.80754 34.5562 8.90393C35.6705 10.009 35.3962 12.0209 35.3962 13.4349C35.3962 15.2219 35.7871 16.0436 37.0596 17.3162C38.9527 19.2092 39.8992 20.1557 39.8992 21.3319C39.8992 22.508 38.9527 23.4546 37.0596 25.3476C35.787 26.6202 35.3962 27.4419 35.3962 29.2289C35.3962 30.643 35.6705 32.6549 34.5561 33.7599Z" stroke="#141B34" stroke-width="2.75935"/>
<path d="M16.8184 22.9169L20.0141 25.7702L27.4709 16.8931" stroke="#141B34" stroke-width="2.75935" stroke-linecap="round" stroke-linejoin="round"/>
</svg>
            </div>
            <p class="text-[#5b3f2e] text-xl md:text-2xl font-medium flex-1">
              Asegúrate de que tu archivo cumpla con los requisitos
            </p>
            <div class="w-9 h-9 flex items-center justify-center">
              <svg class="w-9 h-9 text-[#5b3f2e]" fill="currentColor" viewBox="0 0 24 24">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/>
              </svg>
            </div>
          </div>
          
          <!-- Item 3 -->
          <div class="bg-[#f0dc1c] rounded-[162px] px-8 py-7 flex items-center gap-4 checklist-item ml-32 md:ml-64 animate-fade-in-up animation-delay-1000">
            
            <div class="w-10 h-10 flex items-center justify-center">
              <svg xmlns="http://www.w3.org/2000/svg" width="44" height="43" viewBox="0 0 44 43" fill="none">
<path d="M34.5561 33.7599H34.5729M34.5561 33.7599C33.4505 34.8563 31.4469 34.5832 30.0419 34.5832C28.3172 34.5832 27.4867 34.9205 26.2558 36.1514C25.2077 37.1997 23.8026 39.0862 22.1449 39.0862C20.4872 39.0862 19.0821 37.1997 18.034 36.1514C16.8032 34.9205 15.9726 34.5832 14.2479 34.5832C12.8429 34.5832 10.8393 34.8563 9.73376 33.7599C8.61936 32.6549 8.89361 30.643 8.89361 29.2289C8.89361 27.4419 8.5028 26.6202 7.23021 25.3476C5.33718 23.4546 4.39066 22.508 4.39062 21.3319C4.39064 20.1557 5.33714 19.2092 7.23016 17.3162C8.36617 16.1802 8.89361 15.0545 8.89361 13.4349C8.89361 12.0298 8.62057 10.0262 9.71691 8.92069C10.822 7.80632 12.8339 8.08059 14.248 8.08059C15.8675 8.08059 16.9932 7.55318 18.1292 6.41721C20.0222 4.52415 20.9687 3.57764 22.1449 3.57764C23.3211 3.57764 24.2676 4.52415 26.1606 6.41721C27.2963 7.55295 28.422 8.08059 30.0419 8.08059C31.4469 8.08059 33.4507 7.80754 34.5562 8.90393C35.6705 10.009 35.3962 12.0209 35.3962 13.4349C35.3962 15.2219 35.7871 16.0436 37.0596 17.3162C38.9527 19.2092 39.8992 20.1557 39.8992 21.3319C39.8992 22.508 38.9527 23.4546 37.0596 25.3476C35.787 26.6202 35.3962 27.4419 35.3962 29.2289C35.3962 30.643 35.6705 32.6549 34.5561 33.7599Z" stroke="#141B34" stroke-width="2.75935"/>
<path d="M16.8184 22.9169L20.0141 25.7702L27.4709 16.8931" stroke="#141B34" stroke-width="2.75935" stroke-linecap="round" stroke-linejoin="round"/>
</svg>
            </div>
            <p class="text-[#5b3f2e] text-xl md:text-2xl font-medium flex-1">
              Cuanto más creativo, tendrás más posibilidades.
            </p>
            <div class="w-9 h-9 flex items-center justify-center">
              <svg class="w-9 h-9 text-[#5b3f2e]" fill="currentColor" viewBox="0 0 24 24">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/>
              </svg>
            </div>
          </div>
          
          <!-- Decorative Lines -->
          <div class="absolute top-[90px] left-[-10px]   transform rotate-[15deg] hidden lg:block">
            <svg xmlns="http://www.w3.org/2000/svg" width="120" height="79" viewBox="0 0 174 79" fill="none">
              <path d="M148.333 57.6208C146.388 57.0804 144.46 56.5114 142.506 56.0055C138.925 55.0681 136.876 51.9863 137.733 48.775C138.568 45.6828 141.127 44.6013 145.098 45.9586C150.177 47.6989 155.152 49.7727 160.246 51.4689C162.978 52.3741 165.989 52.458 168.628 53.5307C170.634 54.3355 173.038 55.7787 173.791 57.5472C174.433 59.046 173.426 61.7762 172.299 63.3652C169.381 67.5071 166.01 71.3491 162.769 75.2603C161.904 76.3096 161.001 77.6283 159.832 78.059C158.114 78.7012 156.14 78.6487 154.277 78.9065C154.153 76.6312 153.169 73.9177 154.07 72.1584C155.853 68.6684 158.673 65.7159 161.201 62.3384C158.996 60.8347 157.481 60.1415 156.216 63.0676C155.099 65.6345 152.913 66.8458 149.989 67.0038C134.85 67.8364 119.686 69.7849 104.591 69.301C94.0488 68.9593 83.4883 65.6902 73.1242 62.9981C67.7468 61.6015 62.385 59.2297 57.7053 56.2249C48.995 50.6266 43.4127 43.0694 47.0626 31.6692C38.9206 28.5744 31.0761 25.6015 23.2402 22.594C15.986 19.8087 8.89684 16.7419 3.95989 10.2991C3.79797 10.09 3.46339 9.98458 3.33863 9.75909C1.89317 6.99279 -0.779249 3.75535 2.12253 1.1605C5.2632 -1.64244 7.91587 1.43604 10.0315 3.84147C15.9663 10.6102 24.3165 13.0382 32.2115 16.2694C37.4294 18.4037 42.8308 20.1216 47.9775 22.4104C50.6792 23.6162 52.3086 23.0509 53.9762 20.9256C62.7689 9.7084 75.0515 6.01416 88.6208 5.61132C94.7437 5.43001 100.161 8.26314 105.037 11.6982C109.956 15.1479 109.67 21.5563 105.826 26.0175C95.1843 38.3796 81.1216 37.3648 67.0086 36.3448C63.0781 36.0646 59.1858 35.1962 55.2124 34.5826C53.5389 39.1671 54.3104 42.6381 57.838 45.6451C65.4214 52.1138 74.3623 55.5949 83.8921 57.7451C95.7841 60.4333 107.786 62.4193 120.024 61.3725C129.456 60.572 138.854 59.4035 148.256 58.3973C148.272 58.1408 148.287 57.8843 148.302 57.6277L148.333 57.6208ZM60.575 25.5057C71.0913 29.3726 94.7653 29.7268 100.249 17.7977C92.3634 9.31378 68.5636 14.3116 60.575 25.5057Z" fill="#5B3F2E"/>
              </svg>
          </div>
          <div class="absolute top-[220px] left-[120px]  transform rotate-[15deg] hidden lg:block">
            <svg xmlns="http://www.w3.org/2000/svg" width="120" height="79" viewBox="0 0 174 79" fill="none">
              <path d="M148.333 57.6208C146.388 57.0804 144.46 56.5114 142.506 56.0055C138.925 55.0681 136.876 51.9863 137.733 48.775C138.568 45.6828 141.127 44.6013 145.098 45.9586C150.177 47.6989 155.152 49.7727 160.246 51.4689C162.978 52.3741 165.989 52.458 168.628 53.5307C170.634 54.3355 173.038 55.7787 173.791 57.5472C174.433 59.046 173.426 61.7762 172.299 63.3652C169.381 67.5071 166.01 71.3491 162.769 75.2603C161.904 76.3096 161.001 77.6283 159.832 78.059C158.114 78.7012 156.14 78.6487 154.277 78.9065C154.153 76.6312 153.169 73.9177 154.07 72.1584C155.853 68.6684 158.673 65.7159 161.201 62.3384C158.996 60.8347 157.481 60.1415 156.216 63.0676C155.099 65.6345 152.913 66.8458 149.989 67.0038C134.85 67.8364 119.686 69.7849 104.591 69.301C94.0488 68.9593 83.4883 65.6902 73.1242 62.9981C67.7468 61.6015 62.385 59.2297 57.7053 56.2249C48.995 50.6266 43.4127 43.0694 47.0626 31.6692C38.9206 28.5744 31.0761 25.6015 23.2402 22.594C15.986 19.8087 8.89684 16.7419 3.95989 10.2991C3.79797 10.09 3.46339 9.98458 3.33863 9.75909C1.89317 6.99279 -0.779249 3.75535 2.12253 1.1605C5.2632 -1.64244 7.91587 1.43604 10.0315 3.84147C15.9663 10.6102 24.3165 13.0382 32.2115 16.2694C37.4294 18.4037 42.8308 20.1216 47.9775 22.4104C50.6792 23.6162 52.3086 23.0509 53.9762 20.9256C62.7689 9.7084 75.0515 6.01416 88.6208 5.61132C94.7437 5.43001 100.161 8.26314 105.037 11.6982C109.956 15.1479 109.67 21.5563 105.826 26.0175C95.1843 38.3796 81.1216 37.3648 67.0086 36.3448C63.0781 36.0646 59.1858 35.1962 55.2124 34.5826C53.5389 39.1671 54.3104 42.6381 57.838 45.6451C65.4214 52.1138 74.3623 55.5949 83.8921 57.7451C95.7841 60.4333 107.786 62.4193 120.024 61.3725C129.456 60.572 138.854 59.4035 148.256 58.3973C148.272 58.1408 148.287 57.8843 148.302 57.6277L148.333 57.6208ZM60.575 25.5057C71.0913 29.3726 94.7653 29.7268 100.249 17.7977C92.3634 9.31378 68.5636 14.3116 60.575 25.5057Z" fill="#5B3F2E"/>
              </svg>
          </div>
        </div>
        
        <!-- Upload Button -->
        <div class="flex justify-center animate-fade-in-up animation-delay-1200">
          <div class="relative animate-bounce-subtle">
            <div class="bg-yellow h-24 w-80 rounded-[200px] border-2 border-[#5b3f2e]"></div>
            <div class="absolute inset-0 flex items-center justify-center">
              <a href="https://zibascreators.yummiespromociones.com/" class="bg-[#0167f7] h-16 w-72 rounded-[200px] flex items-center justify-center gap-4 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-white" aria-label="Ir al formulario de participación">
                <span class="text-white text-xl md:text-2xl font-semibold">
                  SUBIR CONTENIDO
                </span>
                <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                  <path d="M12 4l-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8-8-8z"/>
                </svg>
              </a>
            </div>
          </div>
        </div>
        
      </div>
    </section>

    <!-- Categories Section - Pink -->
    <section id="categories" class="bg-pink py-20">
      <div class="container mx-auto px-4">
        <!-- Título centrado -->
        <div class="text-center mb-16 animate-fade-in-up">
          <h2 class="text-white italic text-3xl md:text-5xl font-bold mb-4 animate-fade-in-up animation-delay-200">
            DESCUBRE CADA UNA DE LAS
          </h2>
          <h3 class="text-white italic text-6xl md:text-8xl font-bold animate-fade-in-up animation-delay-400">
            CATEGORÍAS
          </h3>
        </div>
        
        <CategoriesCarousel 
          categories={categoriesData.categories}
          title={categoriesData.title}
          subtitle={categoriesData.description}
          disableLinks={true}
        />
       </div>
    </section>

    <!-- Jurados Section (embedded from Jurados page) -->
    <section id="jurados" class="py-16 bg-blue h-full w-full">
      <div class="container mx-auto px-4">
        {jurTitle && (
          <div class="text-center mb-16 relative z-20 overflow-hidden">
            <div class="absolute left-0 top-0 w-[100%] h-[100%] -z-10 pointer-events-none -ml-[250px]">
              <PixelGrid
                pixelSize={20}
                density={0.7}
                background="none"
                introDuration={800}
                loopInterval={1100}
                mutateAmount={50}
              />
            </div>
         
            {jurDescription && (
              <h1 class="text-6xl md:text-8xl italic font-bold mb-4 text-white relative z-10 flex items-center justify-center">
                <span class="font-title pl-2 relative z-10">{jurDescription}</span>
              </h1>
            )}
          </div>
        )}

        <!-- Swiper styles and script (CDN) -->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.css" />
        <script is:inline src="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.js"></script>

        <!-- Jurors Carousel -->
        <div class="relative">
          <div class="swiper-container jurors-carousel">
            <div class="swiper-wrapper">
              {allJurors.map((person) => (
                <div class="swiper-slide px-2 md:px-4 py-4">
                  <div class="bg-[#005ada] rounded-[30px] flex flex-col md:flex-row items-center justify-center gap-8 md:gap-16 px-6 md:px-12 py-8 text-white relative">
                    <!-- Country Flag Emoji -->
                    <div class="absolute bottom-4 right-4 text-4xl md:text-5xl">
                      {person.countryId === 'guatemala' && '🇬🇹'}
                      {person.countryId === 'honduras' && '🇭🇳'}
                      {person.countryId === 'el_salvador' && '🇸🇻'}
                      {person.countryId === 'republica_dominicana' && '🇩🇴'}
                      {person.countryId === 'costa_rica' && '🇨🇷'}
                    </div>

                    <div class="shrink-0 size-[220px] md:size-[300px] rounded-full bg-cover bg-center" style={`background-image: url('${person.image}')`}>
                    </div>
                    <div class="flex-1 w-full text-center md:text-left">
                      <div class="uppercase">
                        <h3 class="font-title font-black text-3xl md:text-[38px] leading-tight">{person.name}</h3>
                        <p class="font-title font-bold text-lg md:text-xl mt-3 max-w-[44ch]">{person.title}</p>
                      </div>
                      <p class="mt-4 text-base md:text-lg max-w-[60ch] opacity-95">{person.bio}</p>

                      {/* Followers count */}
                      

                      <div class="mt-6">
                        <div class="uppercase font-title font-black text-lg md:text-xl mb-4">Redes sociales:</div>
                        <div class="flex flex-col gap-4 items-center md:items-start">
                          <a href={person.instagramLink} target="_blank" rel="noopener noreferrer" class="flex items-center gap-3 group">
                            <LazyImage src={socialMedia?.instagram?.iconUrl} alt={socialMedia?.instagram?.alt || 'Instagram'} class="w-5 h-5 md:w-6 md:h-6" color='white' loading="lazy" />
                            <span class="font-title italic font-bold text-xl group-hover:underline">@{person.instagram}</span>
                          </a>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              ))}
            </div>

            <!-- Controls -->
            <div class="swiper-button-next"></div>
            <div class="swiper-button-prev"></div>
            <div class="swiper-pagination"></div>
          </div>
        </div>

        <script is:inline>
          function initJurorsCarousel() {
            const el = document.querySelector('.swiper-container.jurors-carousel');
            if (!el) return;
            if (typeof Swiper === 'undefined') {
              setTimeout(initJurorsCarousel, 100);
              return;
            }
            try {
              const swiper = new Swiper('.swiper-container.jurors-carousel', {
                loop: true,
                slidesPerView: 1,
                spaceBetween: 20,
                autoplay: { delay: 5000, disableOnInteraction: false, pauseOnMouseEnter: true },
                pagination: { el: '.jurors-carousel .swiper-pagination', clickable: true, dynamicBullets: true },
                navigation: { nextEl: '.jurors-carousel .swiper-button-next', prevEl: '.jurors-carousel .swiper-button-prev' },
                breakpoints: { 768: { slidesPerView: 1, spaceBetween: 30 } },
                on: { init: function(){ const n=document.querySelector('.jurors-carousel .swiper-button-next'); const p=document.querySelector('.jurors-carousel .swiper-button-prev'); if(n) n.style.display='flex'; if(p) p.style.display='flex'; } }
              });
              setTimeout(() => swiper.update(), 100);
            } catch (error) { console.error('Error initializing jurors carousel:', error); }
          }

          if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initJurorsCarousel);
          } else {
            initJurorsCarousel();
          }
          window.addEventListener('load', initJurorsCarousel);
          document.addEventListener('astro:page-load', initJurorsCarousel);
        </script>

        <style is:global>
          .jurors-carousel .swiper-button-next,
          .jurors-carousel .swiper-button-prev {
            color: #fff !important;
            --swiper-navigation-size: 28px;
            display: flex !important;
            align-items: center;
            justify-content: center;
            width: 44px !important;
            height: 44px !important;
            margin-top: -22px !important;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 50%;
            backdrop-filter: blur(4px);
          }
          .jurors-carousel .swiper-button-next:after,
          .jurors-carousel .swiper-button-prev:after { font-size: 18px !important; font-weight: bold; }
          .jurors-carousel .swiper-pagination-bullet { background: rgba(255, 255, 255, 0.6); }
          .jurors-carousel .swiper-pagination-bullet-active { background: #fff; }
          .jurors-carousel .swiper-slide { opacity: 1 !important; visibility: visible !important; }
        </style>
      </div>
    </section>

    <section id="posts" class="bg-red py-20">
      <div class="container mx-auto px-4">
        <div class="text-center mb-16 animate-fade-in-up">
          <h2 class="text-white italic text-4xl md:text-5xl font-title font-bold mb-4 leading-tight animate-fade-in-up animation-delay-200">
            LO MEJOR DE NUESTRA
          </h2>
          <div class="absolute left-0 top-0 w-[100%] h-[100%] -z-10 pointer-events-none -ml-[250px]">
            <PixelGrid
               pixelSize={20}
               density={0.7}
               background="none"
               introDuration={800}
               loopInterval={1100}
               mutateAmount={50}
             />
          </div>
          <h3 class="text-white italic text-6xl md:text-8xl font-title font-bold leading-tight animate-fade-in-up animation-delay-400">
            COMUNIDAD
          </h3>
        </div>

        {(participations.length === 0 || pagination.pageCount === 0) ? (
          <div class="text-center text-white text-xl md:text-2xl font-semibold">
            Aún no hay resultados que mostrar.
          </div>
        ) : (
          <>
            <div id="posts-grid" class="grid grid-cols-2 md:grid-cols-6 gap-4 md:gap-6">
              {participations.map((p) => {
                const author = `${p.contact?.firstName || ''} ${p.contact?.lastName || ''}`.trim();
                const displayImage = p.thumbnail || p.image || 'https://via.placeholder.com/400x600/ff6b35/ffffff?text=Ziba\'s+Creators';
                return (
                  <PostCard 
                    backgroundImage={displayImage}
                    originalMedia={p.image}
                    description={p.description || 'Sin descripción'}
                    profileName={author || 'Anónimo'}
                    actionUrl={p.link}
                    country={p.country}
                    categories={p.categories}
                  />
                )
              })}
            </div>

            {/* Load more button */}
            {pagination.page < pagination.pageCount && (
              <div class="text-center mt-8">
                <button
                  id="load-more"
                  class="bg-orange text-white font-bold py-3 px-6 rounded-full disabled:opacity-50 disabled:cursor-not-allowed"
                  data-current-page={pagination.page}
                  data-page-count={pagination.pageCount}
                  data-page-size={pagination.pageSize}
                  data-promotion-id={promotionId}
                >
                  Ver más
                </button>
              </div>
            )}
          </>
        )}
      </div>
    </section>

   </MainLayout>

<script src="./scripts.js"></script>
<script>
  document.addEventListener('astro:page-load', () => {
    const API_HOST = import.meta.env.PUBLIC_API_HOST;
    const API_TOKEN = import.meta.env.PUBLIC_API_TOKEN;
    const grid = document.getElementById('posts-grid');
    const btn = document.getElementById('load-more');
    if (!grid || !btn || !API_HOST || !API_TOKEN) return;

    const countryMap = {
      'guatemala': { name: 'Guatemala', flag: '🇬🇹' },
      'honduras': { name: 'Honduras', flag: '🇭🇳' },
      'el_salvador': { name: 'El Salvador', flag: '🇸🇻' },
      'nicaragua': { name: 'Nicaragua', flag: '🇳🇮' },
      'costa_rica': { name: 'Costa Rica', flag: '🇨🇷' },
      'republica_dominicana': { name: 'República Dominicana', flag: '🇩🇴' }
    };

    const getCountryInfo = (code) => countryMap[code] || { name: (code || ''), flag: '🌍' };

    const socialLinkBg = 'https://snack.yummiespromociones.com/zibas/socialmedia.webp';

    let currentPage = Number(btn.dataset.currentPage || '1');
    const pageCount = Number(btn.dataset.pageCount || '1');
    const pageSize = Number(btn.dataset.pageSize || '10');
    const promotionId = Number(btn.dataset.promotionId || '7');

    const buildCard = (p) => {
      const author = `${(p.contact?.firstName || '')} ${(p.contact?.lastName || '')}`.trim() || 'Anónimo';
      const displayImage = p.thumbnail || p.image || 'https://via.placeholder.com/400x600/ff6b35/ffffff?text=Ziba\'s+Creators';
      const originalMedia = p.image;
      const isVideo = (originalMedia || displayImage || '').match(/\.(mp4|webm|mov)(\?|$)/i);
      const countryInfo = getCountryInfo(p.country);
      const categories = Array.isArray(p.categories) ? p.categories : [];

      const wrapper = document.createElement(p.link ? 'button' : 'button');
      wrapper.className = 'block group relative overflow-hidden rounded-[2rem] transition-all duration-300 ease-in-out hover:shadow-[0_0_20px_rgba(0,0,0,0.3)] cursor-pointer';
      wrapper.style.aspectRatio = '9 / 16';

      if (p.link) {
        wrapper.onclick = () => window.open(p.link, '_blank');
      } else {
        const mediaType = isVideo ? 'video' : 'image';
        wrapper.onclick = () => {
          const detail = {
            src: originalMedia || displayImage,
            type: mediaType,
            description: p.description || 'Sin descripción',
            author: author,
            country: p.country,
            categories: categories
          };
          document.dispatchEvent(new CustomEvent('show-lightbox', { detail }));
        };
      }

      // Background container
      const bg = document.createElement('div');
      bg.className = 'absolute inset-0 w-full h-full';

      if (p.link) {
        const img = document.createElement('img');
        img.src = socialLinkBg;
        img.alt = 'Social Media Link';
        img.width = 400;
        img.height = 600;
        img.className = 'w-full h-full object-cover transform transition-transform duration-500 ease-out group-hover:scale-105';
        bg.appendChild(img);
      } else if (isVideo) {
        const video = document.createElement('video');
        video.className = 'w-full h-full object-cover transform transition-transform duration-500 ease-out group-hover:scale-105';
        video.muted = true;
        video.loop = true;
        video.autoplay = true;
        video.playsInline = true;
        const source = document.createElement('source');
        source.src = displayImage; // thumbnail como poster equivalente visual
        source.type = 'video/mp4';
        video.src = originalMedia || displayImage;
        bg.appendChild(video);
      } else {
        const img = document.createElement('img');
        img.src = displayImage;
        img.alt = p.description || 'Post';
        img.width = 400;
        img.height = 600;
        img.className = 'w-full h-full object-cover transform transition-transform duration-500 ease-out group-hover:scale-105';
        bg.appendChild(img);
      }

      // Overlay hover
      const overlay = document.createElement('div');
      overlay.className = 'absolute inset-0 bg-gradient-to-t from-orange/70 via-orange/10 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300';

      // Content always visible
      const content = document.createElement('div');
      content.className = 'absolute inset-0 p-5 flex flex-col justify-end items-center text-center bg-gradient-to-t from-black/80 to-transparent';
      const inner = document.createElement('div');
      inner.className = 'w-full';

      const desc = document.createElement('p');
      desc.className = 'text-white text-sm font-medium mb-3 line-clamp-3';
      desc.textContent = p.description || 'Sin descripción';

      const authorRow = document.createElement('div');
      authorRow.className = 'flex items-center justify-center text-white text-md font-bold gap-2 mb-2';
      authorRow.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" /></svg>';
      const authorSpan = document.createElement('span');
      authorSpan.textContent = author;
      authorRow.appendChild(authorSpan);

      const countryRow = document.createElement('div');
      countryRow.className = 'flex items-center justify-center text-white text-md font-medium gap-1 mb-2 opacity-80';
      const flagSpan = document.createElement('span');
      flagSpan.textContent = countryInfo.flag;
      const countrySpan = document.createElement('span');
      countrySpan.textContent = countryInfo.name;
      if (p.country) {
        countryRow.appendChild(flagSpan);
        countryRow.appendChild(countrySpan);
      }

      const catsRow = document.createElement('div');
      catsRow.className = 'flex flex-wrap justify-center gap-1';
      categories.forEach((c) => {
        const tag = document.createElement('span');
        tag.className = 'bg-white/20 text-white text-md px-2 py-1 rounded-full';
        tag.textContent = c;
        catsRow.appendChild(tag);
      });

      inner.appendChild(desc);
      inner.appendChild(authorRow);
      if (p.country) inner.appendChild(countryRow);
      if (categories.length) inner.appendChild(catsRow);
      content.appendChild(inner);

      wrapper.appendChild(bg);
      wrapper.appendChild(overlay);
      wrapper.appendChild(content);

      return wrapper;
    };

    const fetchNext = async () => {
      if (currentPage >= pageCount) return;
      btn.disabled = true;
      try {
        const nextPage = currentPage + 1;
        const url = `${API_HOST}/v1/auth/participations?promotionId=${promotionId}&page=${nextPage}&pageSize=${pageSize}`;
        const res = await fetch(url, { headers: { 'Authorization': API_TOKEN, 'Content-Type': 'application/json' }});
        if (!res.ok) throw new Error('Error al cargar más participaciones');
        const json = await res.json();
        const items = json?.data || [];
        items.forEach((p) => grid.appendChild(buildCard(p)));
        currentPage = nextPage;
        if (currentPage >= pageCount) {
          btn.style.display = 'none';
        }
      } catch (e) {
        console.error('[ZibasCreatorsView] Load more failed:', e);
      } finally {
        btn.disabled = false;
      }
    };

    btn.addEventListener('click', fetchNext);
  });
</script>
